# encryption_and_vulnerability_check

This Splunk app checks for Splunk Vulnerability Disclosures and gives you an overview of your environment's encryption status.


## How to install


Download all apps.
Place the apps on your servers the following way:
| Name | Deployed on | Description |
| --- | --- | --- |
| app_eavc |One Search Head of your choice | This app contains most of the searches, all dashboards and all of the lookups |
| SA-mc_eavc | On your Monitoring Console | This Supporting Add-on contains a couple of REST searches that only can be ran on the MC to provide complete results. These are written to the app's index (app_eavc). |
| TA_eavc | On all Splunk Enterprise instances | contains a few scripts that will do checks for all instances |
| TA-indexer_eavc | Cluster Manager/manager-apps or on an Indexer if not clustered | With app version 3, an index was added to manage different use cases in bigger distributed environments. The volume of data in that index is pretty low, many searches populating the index only run once every 12 hours. |


## Getting started after installation


After **all** apps were installed, you will not see results immediately. Some reports may be delayed, a few are disabled because they usually only need to run once. All steps except the last step 8 are optional, as they will run after some time.
I do **not** recommend running the reports of the app before the TAs were deployed to all Splunk Enterprise instances because data will be missing and not being re-generated. All SA-MC reports will check whether data is already in that index+sourcetype and not run if found.

1. Run the reports on your Monitoring Console first if they're not run by default. There are several reports starting with "SA-mc_eavc_*"
2. Go to your Search Head, select the Encryption and Vulnerability Check App
3. Select Additional Links > Reports
4. Run "query_splunk_version"
5. Run "populate_uf_versions"
6. Run "populate_svd_upgrade_checks"
7. Run "populate_svd_uf_upgrade_checks" and "populate_svd_app_upgrade_checks"
8. Run "populate_manual_checks_lookup" once. This one is disabled and only needs to be run once. Afterwards, that lookup has to be manually edited because not all checks can be done automatically.

- The app contains a script which connects to this repository. It checks for new Splunk Vulnerability Disclosures (SVDs) inside the lookup and if found, will replace its old CSV file. That way you don't have to upgrade the whole app everytime new vulnerabilities have been made public.
- There are also other scripts, e.g. a script pulling an official list of supported Linux kernels. That information is included in the app as a lookup as well, so it's not required to allow that connection.
- At least one more script for auto-updating will be added (supported Splunk product versions) (3.0.5)
-  I'd recommend to allow the SH to connect to https.//*.github.com for the automatic updates of lookups to stay ahead of future Splunk vulnerabilities
-  The SA-mc reports populating the app_eavc index run usually only once every few days because they will check whether data is found in that index. If you're having changes to your apps, you might want to consider deleting the data and letting the report run again. The indexed data will be kept for 14 days.
-  Inside the Encryption and Vulnerability Check app, you either need to be admin or grant you the r_encryption_check role in order to see all extracted fields and other Knowledge Objects.


## Version 3

**Version 3** was a complete refactoring of the existing app. The most important changes are that the app that used to exist now is divided into an app, a Supporting Add-on and two Technical Add-ons.
Next to the refactoring for bigger environments, many new reports, dashboards, lookups and use cases were implemented.


## Version 2

**Version 2** has its dashboards migrated to the Dashboard Framework with some changes and additions.
Due to limits of the Dashboard Framework's features, drilldowns with tokens are limited, unfortunately.


Biggest changes are the implemented checks for the Splunk Vulnerability Disclosures. These lookups can be updated with the script found under bin (enabled by default). The script runs every 30 minutes and checks for changes on github.

The app contains a few scheduled searches. If you update the lookups OR use the app for the first time, the mitigation status of the SVDs might take a while to update. If you want to fasten things up, run the reports found in the app.

For RBAC, you can use the shipped read-only or writeable role of the app. ~~The app does not contain or need any additional index.~~


New in version 2.3.1 is a report, which can be ran manually to populate a manual checks lookup. 
After running this, check the lookup in order to solve the manual checks displayed in the Splunk Security Advisories dashboard.


## The future / upcoming versions

**Version 3.1.0** is planned to have more use cases (especially for the Mitigation Report dashboard) with more checks. Other searches may be further optimized and more reports added to the MC. Don't worry, there will never be heavy load on the MC. Just simple REST searches to query all Splunk Enterprise instances from a cluster every few hours. 
Right now, the Search Head app (app_eavc) does not contain any alerts. I plan to include (disabled) alerts, e.g. for new vulnerabilities which aren't fixed in the current version. That way you don't have to check the dashboards preemptively.

**Version 3.2.0** will have more version checks for its lookups and several use cases, so it will be more modular and easier to update its content by scripts without requiring to update the app or add-ons manually.

**Version 3.3.0** will undergo another refactoring to rename many of the saved searches, which will help with new installations/setups. As the number of reports keeps growing, it's hard to keep track of what to run first. The scheduled times are set very rarely due to the function of the app: most searches just need to run once and then it's fine if they don't run again for hours or even days.


## About the Content/Use Cases

You may be wondering "what's in it?". I'd say, take a look yourself. It all started as a debugging app with version 1 with some dashboards displaying the status of encryption parameters and some hardening stuff.
Version 2 was a huge advancement to include the matching of Splunk's Vulnerability Disclosures mapped to your environment (what needs to be fixed and what not).
Version 3 was heavily tested for distributed bigger environment and thus needed some changes, making a single app impossible to use for clusters. One could argue to put the app on the MC but the use cases are becoming more and more, so I divided the app into seperate logical parts; getting data by REST, getting data by scripts, indexer related configs and the visuals+reports (app).

Here's a rough estimate what to find in the app:

* a full list of Splunk Vulnerability Disclosures (SVDs) with a mitigation status for each SVD
  * the SVDs Mitigation Status includes Core, ES, ITSI and other apps that may be installed in your environment
* Encryption Overview: display several important parameters for TLS-secured environments and other Splunk-specific configs you might not even know of
* the Splunk Server Status dashboards contain a few dashboards displaying a lot of stuff: forwarder status, indexer, webserver settings, specific Linux server use cases (who owns $SPLUNK_HOME, directory permissions, Kernel version)
* Splunk Supported Versions: lists the End Of Life for Splunk Enterprise, SOAR, UBA, Enterprise Security and IT Service Intelligence and maps it to your environment when ES/ITSI are found
* Mitigation Report: this is basically a list of growing use cases that are focussed on security-related stuff and hardening of your whole Splunk environment. Don't expect to get all checks passed. I've been doing this for many years and I'm very strict. As of app verson 3.0.5, 20 checks (use cases) are included

Upcoming are other checks (you may get a hint from other dashboards), but the most important focus will be adding more hardening and best practice checks to the Mitigation Report, keeping the SVDs up to date, as well as automating the updating of included lookups. I'd like to install this app once, set it up once and then don't care about manual app updates again.
